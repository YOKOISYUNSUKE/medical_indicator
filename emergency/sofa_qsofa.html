<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>SOFA / qSOFA | 医療電算機</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 共通CSS（分割後） -->
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/layout.css" />
  <link rel="stylesheet" href="../css/components.css" />
  <link rel="stylesheet" href="../css/responsive.css" />

  <!-- 共通ヘッダー/フッター読込 -->
  <script src="../js/include.js" defer></script>
  <!-- 共通スコアユーティリティ -->
  <script src="../js/score-utils.js" defer></script>
  <!-- このスコア専用の計算JSがあればここに -->
  <script src="sofa_qsofa.js" defer></script>
</head>

<!-- data-subtitle に、このページ固有のサブタイトルを書く -->
<body data-subtitle="SOFA / qSOFA スコア計算">
  <!-- 共通ヘッダー -->
  <div data-include="../partials/header.html"></div>

  <main>
    <div class="wrapper">
      <div class="score-card-container">
        <a href="emergency.index.html" class="back-link">← 救急スコア一覧に戻る</a>

        <div class="score-title">SOFA / qSOFA</div>
        <div class="score-subtitle">
          ベッドサイドで簡便に評価する qSOFA と、臓器別に評価する SOFA を同じ画面で扱います。
          SOFA は呼吸・凝固・肝・心血管・中枢神経・腎の 6 項目を臓器別に入力して合計スコアを算出します。
        </div>

        <!-- qSOFA 入力 -->
        <div class="section-label">qSOFA 入力</div>
        <form id="qsofa_form" onsubmit="return false;">
          <div class="form-grid">
            <div class="form-row">
              <label for="q_rr">呼吸数 RR (/分)</label>
              <input id="q_rr" type="number" min="0" />
            </div>
            <div class="form-row">
              <label for="q_sbp">収縮期血圧 SBP (mmHg)</label>
              <input id="q_sbp" type="number" min="0" />
            </div>
            <div class="form-row">
              <label for="q_gcs">GCS 合計</label>
              <input id="q_gcs" type="number" min="3" max="15" />
            </div>
          </div>

          <div class="small-note">
            qSOFA 条件：<br />
            ・RR ≥ 22 /min<br />
            ・SBP ≤ 100 mmHg<br />
            ・GCS &lt; 15<br />
            上記 3 項目のうち該当数（0–3点）で評価します。
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-primary" onclick="calculateQSOFA()">
              qSOFA計算
            </button>
            <button type="button" class="btn btn-secondary" onclick="clearQSOFA()">
              クリア
            </button>
          </div>
        </form>
        <div class="result-card" id="card_qsofa">
          <div class="result-title">qSOFA</div>
          <div class="result-value">--</div>
          <div class="result-category"></div>
          <div class="result-message">
            RR、SBP、GCS から算出されるベッドサイド評価スコアです。
          </div>
        </div>
        <!-- SOFA 臓器別入力 -->
        <div class="section-label">
          SOFA 臓器別入力
          <small>（基準は原法に準じた代表的なカットオフ）</small>
        </div>

        <form id="sofa_organ_form" onsubmit="return false;">
          <!-- 呼吸 -->
          <div class="section-label">① 呼吸：PaO₂ / FiO₂ 比</div>
          <div class="form-grid">
            <div class="form-row">
              <label for="sofa_pao2">PaO₂ (mmHg)</label>
              <input id="sofa_pao2" type="number" min="0" step="1" />
            </div>
            <div class="form-row">
              <label for="sofa_fio2">FiO₂ (%)</label>
              <input id="sofa_fio2" type="number" min="21" max="100" step="1" />
            </div>
            <div class="form-row">
              <label>人工呼吸器管理</label>
              <div class="check-row">
                <input id="sofa_vent" type="checkbox" />
                <span>人工呼吸器あり</span>
              </div>
            </div>
          </div>
          <div class="small-note">
            スコア目安：<br />
            0点：PaO₂/FiO₂ ≥ 400<br />
            1点：&lt; 400<br />
            2点：&lt; 300<br />
            3点：&lt; 200 かつ人工呼吸器あり<br />
            4点：&lt; 100 かつ人工呼吸器あり
          </div>

          <!-- 凝固 -->
          <div class="section-label">② 凝固：血小板数</div>
          <div class="form-grid">
            <div class="form-row">
              <label for="sofa_plt">血小板数 (×10³/μL)</label>
              <input id="sofa_plt" type="number" min="0" step="1" />
            </div>
          </div>
          <div class="small-note">
            スコア目安：<br />
            0点：≥150<br />
            1点：&lt;150<br />
            2点：&lt;100<br />
            3点：&lt;50<br />
            4点：&lt;20
          </div>

          <!-- 肝 -->
          <div class="section-label">③ 肝：総ビリルビン</div>
          <div class="form-grid">
            <div class="form-row">
              <label for="sofa_bil">総ビリルビン (mg/dL)</label>
              <input id="sofa_bil" type="number" min="0" step="0.1" />
            </div>
          </div>
          <div class="small-note">
            スコア目安：<br />
            0点：&lt;1.2<br />
            1点：1.2–1.9<br />
            2点：2.0–5.9<br />
            3点：6.0–11.9<br />
            4点：≥12.0
          </div>

          <!-- 心血管 -->
          <div class="section-label">④ 心血管：血圧 / 昇圧薬</div>
          <div class="form-grid">
            <div class="form-row">
              <label for="sofa_map">平均血圧 MAP (mmHg)</label>
              <input id="sofa_map" type="number" min="0" step="1" />
            </div>
            <div class="form-row">
              <label for="sofa_cvs_cat">昇圧薬カテゴリ（最も高いもの）</label>
              <select id="sofa_cvs_cat">
                <option value="0">昇圧薬なし</option>
                <option value="1">MAP &lt; 70 mmHg（昇圧薬なし）</option>
                <option value="2">ドブタミン任意 または ドパミン ≤ 5 μg/kg/min</option>
                <option value="3">ドパミン &gt;5–15 または アドレナリン/ノルアドレナリン ≤ 0.1 μg/kg/min</option>
                <option value="4">ドパミン &gt;15 または アドレナリン/ノルアドレナリン &gt; 0.1 μg/kg/min</option>
              </select>
            </div>
          </div>
          <div class="small-note">
            スコアは、MAP と昇圧薬の情報から「より重い方」で評価します。<br />
            例：MAP 60 &amp; 昇圧薬なし → 1点 / ノルアドレナリン 0.05 → 3点 など。
          </div>

          <!-- 中枢神経 -->
          <div class="section-label">⑤ 中枢神経：GCS</div>
          <div class="form-grid">
            <div class="form-row">
              <label for="sofa_gcs">GCS 合計</label>
              <input id="sofa_gcs" type="number" min="3" max="15" />
            </div>
          </div>
          <div class="small-note">
            スコア目安：<br />
            0点：15<br />
            1点：13–14<br />
            2点：10–12<br />
            3点：6–9<br />
            4点：&lt;6
          </div>

          <!-- 腎 -->
          <div class="section-label">⑥ 腎：Cr / 尿量</div>
          <div class="form-grid">
            <div class="form-row">
              <label for="sofa_cr">血清クレアチニン (mg/dL)</label>
              <input id="sofa_cr" type="number" min="0" step="0.1" />
            </div>
            <div class="form-row">
              <label for="sofa_urine">尿量 (mL/日)</label>
              <input id="sofa_urine" type="number" min="0" step="1" />
            </div>
          </div>
          <div class="small-note">
            クレアチニンによるスコア目安：<br />
            0点：&lt;1.2<br />
            1点：1.2–1.9<br />
            2点：2.0–3.4<br />
            3点：3.5–4.9<br />
            4点：≥5.0<br />
            尿量が 500 &lt;= x &lt; 200 mL/日 の場合も、それぞれ 3点・4点の基準となります（より重い方を採用）。
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-primary" onclick="calculateSOFAOrgan()">
              SOFA臓器別計算
            </button>
            <button type="button" class="btn btn-secondary" onclick="clearSOFAOrgan()">
              SOFAクリア
            </button>
          </div>
        </form>

        <!-- 結果表示 -->
        <div class="result-area">
          <div class="result-card" id="card_sofa_total">
            <div class="result-title">SOFA 合計スコア</div>
            <div class="result-value">--</div>
            <div class="result-category"></div>
            <div class="result-message">
              6 臓器のスコアの合計です。入力されていない臓器がある場合は参考値として扱ってください。
            </div>
          </div>

          <div class="result-card" id="card_sofa_detail">
            <div class="result-title">SOFA 臓器別内訳</div>
            <div class="result-value">—</div>
            <div class="result-category"></div>
            <div class="result-message">
              呼吸：-- 点
              凝固：-- 点
              肝：-- 点
              心血管：-- 点
              中枢神経：-- 点
              腎：-- 点
            </div>
          </div>
        </div>

        <div class="result-warning">
          ※ 本ツールは教育・参考用です。公式 SOFA スコアの基準に準じていますが、施設ごとの運用差や除外条件を反映していない可能性があります。<br />
          ※ 計算結果は参考値であり、診断・治療方針は必ず臨床医の総合判断で行ってください。
        </div>
      </div>
    </div>
  </main>

  <footer>
    © 医療電算機 v0.1
  </footer>
  <!-- 共通フッター -->
  <div data-include="../partials/footer.html"></div>
</body>
</html>
